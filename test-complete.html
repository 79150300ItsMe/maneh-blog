<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete SEO & Routing Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .pass { background-color: #d4edda; border-color: #c3e6cb; }
        .fail { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        #results { margin-top: 20px; }
        .test-summary { margin: 20px 0; padding: 20px; background: #f8f9fa; border-radius: 5px; }
        .test-summary.pass { background: #d4edda; }
        .test-summary.fail { background: #f8d7da; }
        .progress-bar { width: 100%; height: 20px; background: #e9ecef; border-radius: 10px; overflow: hidden; }
        .progress-fill { height: 100%; background: #28a745; transition: width 0.3s ease; }
        .route-test { margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 3px; }
        .route-test.pass { background: #d4edda; }
        .route-test.fail { background: #f8d7da; }
    </style>
</head>
<body>
    <h1>Complete SEO & Routing Test</h1>
    
    <div class="test-section info">
        <h3>Test Instructions</h3>
        <p>1. Make sure your blog is running on localhost:5503</p>
        <p>2. Click "Run Complete Test" to test everything</p>
        <p>3. Check console for detailed results</p>
    </div>
    
    <div class="test-section">
        <h3>Test Controls</h3>
        <button onclick="runCompleteTest()">Run Complete Test</button>
        <button onclick="testCurrentPage()">Test Current Page</button>
        <button onclick="testAllRoutes()">Test All Routes</button>
        <button onclick="clearResults()">Clear Results</button>
    </div>
    
    <div class="test-section">
        <h3>Progress</h3>
        <div class="progress-bar">
            <div class="progress-fill" id="progress" style="width: 0%"></div>
        </div>
        <div id="progress-text">Ready to start...</div>
    </div>
    
    <div id="results"></div>

    <script>
        const testRoutes = [
            { path: '/', name: 'Home', type: 'page' },
            { path: '#about', name: 'About', type: 'page' },
            { path: '#policy', name: 'Privacy Policy', type: 'page' },
            { path: '#contact', name: 'Contact', type: 'page' },
            { path: '/2025/01/22/setup-vscode-web-development-panduan-lengkap', name: 'Article', type: 'article' },
            { path: '#category/tutorial', name: 'Category', type: 'page' }
        ];

        let testResults = {
            total: 0,
            passed: 0,
            failed: 0,
            warnings: 0,
            routes: {}
        };

        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `test-section ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong>: ${message}`;
            results.appendChild(div);
            console.log(`[${type.toUpperCase()}] ${message}`);
            
            // Update counters
            if (type === 'pass') testResults.passed++;
            else if (type === 'fail') testResults.failed++;
            else if (type === 'warning') testResults.warnings++;
            testResults.total++;
            
            updateProgress();
        }

        function updateProgress() {
            const progress = document.getElementById('progress');
            const progressText = document.getElementById('progress-text');
            
            if (testResults.total > 0) {
                const percentage = (testResults.passed / testResults.total) * 100;
                progress.style.width = `${percentage}%`;
                progressText.textContent = `${testResults.passed}/${testResults.total} tests passed (${percentage.toFixed(1)}%)`;
            }
        }

        function testCurrentPage() {
            log('Testing Current Page...', 'info');
            clearResults();
            
            // Test 1: Console Errors
            testConsoleErrors();
            
            // Test 2: Meta Tags
            testMetaTags();
            
            // Test 3: Structured Data
            testStructuredData();
            
            // Test 4: AdSense Compliance
            testAdSenseCompliance();
            
            // Test 5: Performance
            testPerformance();
        }

        async function testAllRoutes() {
            log('Testing All Routes...', 'info');
            clearResults();
            
            for (const route of testRoutes) {
                await testRoute(route);
            }
            
            showRouteSummary();
        }

        async function runCompleteTest() {
            log('Running Complete Test...', 'info');
            clearResults();
            
            // Test current page first
            testCurrentPage();
            
            // Wait a bit for current page tests to complete
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            // Test all routes
            await testAllRoutes();
            
            // Final summary
            setTimeout(() => {
                showCompleteSummary();
            }, 1000);
        }

        function testConsoleErrors() {
            log('Testing Console Errors...', 'info');
            
            const errorPatterns = [
                'ReferenceError',
                'TypeError',
                'undefined is not a function',
                'Cannot read property',
                'runUrl is not defined',
                'fullUrl is not defined'
            ];
            
            let hasErrors = false;
            errorPatterns.forEach(pattern => {
                if (console.error && console.error.toString().includes(pattern)) {
                    log(`✗ Console error found: ${pattern}`, 'fail');
                    hasErrors = true;
                }
            });
            
            if (!hasErrors) {
                log('✓ No console errors found', 'pass');
            }
        }

        function testMetaTags() {
            log('Testing Meta Tags...', 'info');
            
            // Title
            const title = document.title;
            if (title && title.length > 0) {
                log('✓ Title present', 'pass');
                if (title.length <= 65) {
                    log('✓ Title length OK', 'pass');
                } else {
                    log('✗ Title too long', 'fail');
                }
            } else {
                log('✗ No title', 'fail');
            }
            
            // Meta description
            const desc = document.querySelector('meta[name="description"]');
            if (desc && desc.content) {
                log('✓ Meta description present', 'pass');
                if (desc.content.length <= 155) {
                    log('✓ Description length OK', 'pass');
                } else {
                    log('✗ Description too long', 'fail');
                }
            } else {
                log('✗ No meta description', 'fail');
            }
            
            // Canonical
            const canon = document.querySelector('link[rel="canonical"]');
            if (canon && canon.href) {
                log('✓ Canonical present', 'pass');
            } else {
                log('✗ No canonical', 'fail');
            }
            
            // Open Graph
            const ogTags = ['og:title', 'og:description', 'og:image', 'og:url'];
            let ogCount = 0;
            ogTags.forEach(tag => {
                if (document.querySelector(`meta[property="${tag}"]`)) {
                    ogCount++;
                }
            });
            
            if (ogCount === ogTags.length) {
                log('✓ All Open Graph tags present', 'pass');
            } else {
                log(`✗ Missing ${ogTags.length - ogCount} Open Graph tags`, 'fail');
            }
            
            // Twitter Cards
            const twTags = ['twitter:card', 'twitter:title', 'twitter:description', 'twitter:image'];
            let twCount = 0;
            twTags.forEach(tag => {
                if (document.querySelector(`meta[name="${tag}"]`)) {
                    twCount++;
                }
            });
            
            if (twCount === twTags.length) {
                log('✓ All Twitter Card tags present', 'pass');
            } else {
                log(`✗ Missing ${twTags.length - twCount} Twitter Card tags`, 'fail');
            }
        }

        function testStructuredData() {
            log('Testing Structured Data...', 'info');
            
            const jsonLdScripts = document.querySelectorAll('script[type="application/ld+json"]');
            
            if (jsonLdScripts.length === 0) {
                log('✗ No structured data found', 'fail');
                return;
            }
            
            log(`✓ Found ${jsonLdScripts.length} structured data script(s)`, 'pass');
            
            jsonLdScripts.forEach((script, index) => {
                try {
                    const data = JSON.parse(script.textContent);
                    
                    if (data['@context'] === 'https://schema.org') {
                        log(`✓ Script ${index + 1} has correct @context`, 'pass');
                    } else {
                        log(`✗ Script ${index + 1} has incorrect @context`, 'fail');
                    }
                    
                    if (data['@type']) {
                        log(`✓ Script ${index + 1} has @type: ${data['@type']}`, 'pass');
                    } else {
                        log(`✗ Script ${index + 1} missing @type`, 'fail');
                    }
                    
                } catch (e) {
                    log(`✗ Script ${index + 1} is not valid JSON`, 'fail');
                }
            });
        }

        function testAdSenseCompliance() {
            log('Testing AdSense Compliance...', 'info');
            
            // Check CSP
            const cspMeta = document.querySelector('meta[http-equiv="Content-Security-Policy"]');
            if (cspMeta) {
                log('✓ CSP meta tag found', 'pass');
                
                const requiredDomains = [
                    'www.googletagmanager.com',
                    'pagead2.googlesyndication.com',
                    'googleads.g.doubleclick.net'
                ];
                
                let foundDomains = 0;
                requiredDomains.forEach(domain => {
                    if (cspMeta.content.includes(domain)) {
                        foundDomains++;
                    }
                });
                
                if (foundDomains === requiredDomains.length) {
                    log('✓ All required AdSense domains in CSP', 'pass');
                } else {
                    log(`✗ Only ${foundDomains}/${requiredDomains.length} domains in CSP`, 'fail');
                }
            } else {
                log('✗ No CSP meta tag found', 'fail');
            }
            
            // Check AdSense script
            const adsenseScript = document.querySelector('script[src*="adsbygoogle.js"]');
            if (adsenseScript) {
                log('✓ AdSense script found', 'pass');
            } else {
                log('✗ AdSense script not found', 'fail');
            }
        }

        function testPerformance() {
            log('Testing Performance...', 'info');
            
            // Test preconnect links
            const preconnects = document.querySelectorAll('link[rel="preconnect"]');
            if (preconnects.length > 0) {
                log(`✓ Found ${preconnects.length} preconnect links`, 'pass');
            } else {
                log('✗ No preconnect links found', 'fail');
            }
            
            // Test DNS prefetch
            const prefetches = document.querySelectorAll('link[rel="dns-prefetch"]');
            if (prefetches.length > 0) {
                log(`✓ Found ${prefetches.length} DNS prefetch links`, 'pass');
            } else {
                log('✗ No DNS prefetch links found', 'fail');
            }
        }

        async function testRoute(route) {
            return new Promise((resolve) => {
                log(`Testing route: ${route.name} (${route.path})`, 'info');
                
                // Create iframe to test route
                const iframe = document.createElement('iframe');
                iframe.style.display = 'none';
                iframe.src = `http://localhost:5503${route.path}`;
                document.body.appendChild(iframe);
                
                iframe.onload = () => {
                    setTimeout(() => {
                        try {
                            const doc = iframe.contentDocument || iframe.contentWindow.document;
                            
                            // Check for errors
                            const hasErrors = doc.title.includes('Error') || 
                                            doc.body.textContent.includes('ReferenceError') ||
                                            doc.body.textContent.includes('TypeError');
                            
                            if (hasErrors) {
                                log(`✗ ${route.name} has errors`, 'fail');
                                testResults.routes[route.name] = { status: 'fail', errors: ['Has errors'] };
                                resolve(false);
                                return;
                            }
                            
                            // Check basic SEO elements
                            const title = doc.title;
                            const desc = doc.querySelector('meta[name="description"]');
                            const canon = doc.querySelector('link[rel="canonical"]');
                            const ogTitle = doc.querySelector('meta[property="og:title"]');
                            const ogDesc = doc.querySelector('meta[property="og:description"]');
                            const ogImage = doc.querySelector('meta[property="og:image"]');
                            const twTitle = doc.querySelector('meta[name="twitter:title"]');
                            const twDesc = doc.querySelector('meta[name="twitter:description"]');
                            const twImage = doc.querySelector('meta[name="twitter:image"]');
                            const jsonLd = doc.querySelector('script[type="application/ld+json"]');
                            
                            let score = 0;
                            const maxScore = 10;
                            const errors = [];
                            
                            if (title) score++; else errors.push('No title');
                            if (desc && desc.content) score++; else errors.push('No description');
                            if (canon && canon.href) score++; else errors.push('No canonical');
                            if (ogTitle && ogTitle.content) score++; else errors.push('No OG title');
                            if (ogDesc && ogDesc.content) score++; else errors.push('No OG description');
                            if (ogImage && ogImage.content) score++; else errors.push('No OG image');
                            if (twTitle && twTitle.content) score++; else errors.push('No Twitter title');
                            if (twDesc && twDesc.content) score++; else errors.push('No Twitter description');
                            if (twImage && twImage.content) score++; else errors.push('No Twitter image');
                            if (jsonLd) score++; else errors.push('No JSON-LD');
                            
                            if (score === maxScore) {
                                log(`✓ ${route.name} passed all tests (${score}/${maxScore})`, 'pass');
                                testResults.routes[route.name] = { status: 'pass', score: score, maxScore: maxScore };
                            } else {
                                log(`✗ ${route.name} failed some tests (${score}/${maxScore})`, 'fail');
                                testResults.routes[route.name] = { status: 'fail', score: score, maxScore: maxScore, errors: errors };
                            }
                            
                            document.body.removeChild(iframe);
                            resolve(score === maxScore);
                            
                        } catch (e) {
                            log(`✗ Error testing ${route.name}: ${e.message}`, 'fail');
                            testResults.routes[route.name] = { status: 'fail', errors: [e.message] };
                            document.body.removeChild(iframe);
                            resolve(false);
                        }
                    }, 2000);
                };
                
                iframe.onerror = () => {
                    log(`✗ Could not load ${route.name}`, 'fail');
                    testResults.routes[route.name] = { status: 'fail', errors: ['Could not load'] };
                    document.body.removeChild(iframe);
                    resolve(false);
                };
            });
        }

        function showRouteSummary() {
            const summary = document.createElement('div');
            summary.className = 'test-summary';
            
            let routeSummary = '<h3>Route Test Summary</h3>';
            Object.entries(testResults.routes).forEach(([name, result]) => {
                const status = result.status === 'pass' ? '✓' : '✗';
                const score = result.score ? ` (${result.score}/${result.maxScore})` : '';
                routeSummary += `<p>${status} ${name}${score}</p>`;
            });
            
            summary.innerHTML = routeSummary;
            document.getElementById('results').appendChild(summary);
        }

        function showCompleteSummary() {
            const summary = document.createElement('div');
            summary.className = `test-summary ${testResults.failed === 0 ? 'pass' : 'fail'}`;
            
            const passRate = ((testResults.passed / testResults.total) * 100).toFixed(1);
            
            summary.innerHTML = `
                <h3>Complete Test Summary</h3>
                <p><strong>Total Tests:</strong> ${testResults.total}</p>
                <p><strong>Passed:</strong> ${testResults.passed}</p>
                <p><strong>Failed:</strong> ${testResults.failed}</p>
                <p><strong>Warnings:</strong> ${testResults.warnings}</p>
                <p><strong>Pass Rate:</strong> ${passRate}%</p>
                <p><strong>Status:</strong> ${testResults.failed === 0 ? '✅ All tests passed!' : '❌ Some tests failed'}</p>
            `;
            
            document.getElementById('results').appendChild(summary);
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
            testResults = { total: 0, passed: 0, failed: 0, warnings: 0, routes: {} };
            updateProgress();
        }

        // Auto-run basic tests on load
        window.addEventListener('load', () => {
            log('Complete SEO & Routing Test loaded', 'info');
            log('Click "Run Complete Test" to start comprehensive verification', 'info');
        });
    </script>
</body>
</html>