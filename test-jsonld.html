<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON-LD Validation Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .pass { background-color: #d4edda; border-color: #c3e6cb; }
        .fail { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        #results { margin-top: 20px; }
        .json-ld { margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 3px; font-family: monospace; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>JSON-LD Validation Test</h1>
    
    <div class="test-section info">
        <h3>Test Instructions</h3>
        <p>1. Open this page in the same domain as your blog</p>
        <p>2. Click "Test JSON-LD" to verify structured data</p>
        <p>3. Check console for validation results</p>
    </div>
    
    <div class="test-section">
        <h3>Test Controls</h3>
        <button onclick="testJSONLD()">Test JSON-LD</button>
        <button onclick="testArticleSchema()">Test Article Schema</button>
        <button onclick="testWebPageSchema()">Test WebPage Schema</button>
        <button onclick="clearResults()">Clear Results</button>
    </div>
    
    <div id="results"></div>

    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `test-section ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong>: ${message}`;
            results.appendChild(div);
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        function testJSONLD() {
            log('Testing JSON-LD structured data...', 'info');
            
            // Find all JSON-LD scripts
            const jsonLdScripts = document.querySelectorAll('script[type="application/ld+json"]');
            
            if (jsonLdScripts.length === 0) {
                log('✗ No JSON-LD scripts found', 'fail');
                return;
            }
            
            log(`✓ Found ${jsonLdScripts.length} JSON-LD script(s)`, 'pass');
            
            jsonLdScripts.forEach((script, index) => {
                try {
                    const data = JSON.parse(script.textContent);
                    
                    // Check required fields
                    const requiredFields = ['@context', '@type'];
                    const missingFields = requiredFields.filter(field => !data[field]);
                    
                    if (missingFields.length === 0) {
                        log(`✓ JSON-LD ${index + 1} has required fields`, 'pass');
                    } else {
                        log(`✗ JSON-LD ${index + 1} missing fields: ${missingFields.join(', ')}`, 'fail');
                    }
                    
                    // Check @context
                    if (data['@context'] === 'https://schema.org') {
                        log(`✓ JSON-LD ${index + 1} has correct @context`, 'pass');
                    } else {
                        log(`✗ JSON-LD ${index + 1} has incorrect @context: ${data['@context']}`, 'fail');
                    }
                    
                    // Check @type
                    const validTypes = ['Article', 'NewsArticle', 'WebPage', 'Blog', 'Organization'];
                    if (validTypes.includes(data['@type'])) {
                        log(`✓ JSON-LD ${index + 1} has valid @type: ${data['@type']}`, 'pass');
                    } else {
                        log(`✗ JSON-LD ${index + 1} has invalid @type: ${data['@type']}`, 'fail');
                    }
                    
                    // Check specific fields based on type
                    if (data['@type'] === 'Article' || data['@type'] === 'NewsArticle') {
                        const articleFields = ['headline', 'description', 'author', 'publisher'];
                        const missingArticleFields = articleFields.filter(field => !data[field]);
                        
                        if (missingArticleFields.length === 0) {
                            log(`✓ JSON-LD ${index + 1} has all required article fields`, 'pass');
                        } else {
                            log(`✗ JSON-LD ${index + 1} missing article fields: ${missingArticleFields.join(', ')}`, 'fail');
                        }
                    }
                    
                    if (data['@type'] === 'WebPage') {
                        const pageFields = ['name', 'description', 'mainEntityOfPage'];
                        const missingPageFields = pageFields.filter(field => !data[field]);
                        
                        if (missingPageFields.length === 0) {
                            log(`✓ JSON-LD ${index + 1} has all required page fields`, 'pass');
                        } else {
                            log(`✗ JSON-LD ${index + 1} missing page fields: ${missingPageFields.join(', ')}`, 'fail');
                        }
                    }
                    
                    // Display JSON-LD content
                    const jsonDiv = document.createElement('div');
                    jsonDiv.className = 'json-ld';
                    jsonDiv.textContent = JSON.stringify(data, null, 2);
                    results.appendChild(jsonDiv);
                    
                } catch (e) {
                    log(`✗ JSON-LD ${index + 1} is not valid JSON: ${e.message}`, 'fail');
                }
            });
        }

        function testArticleSchema() {
            log('Testing Article Schema...', 'info');
            
            // Create test article schema
            const testSchema = {
                "@context": "https://schema.org",
                "@type": "NewsArticle",
                "mainEntityOfPage": location.origin + location.pathname,
                "headline": "Test Article",
                "description": "This is a test article for JSON-LD validation",
                "image": "https://example.com/test.jpg",
                "author": {"@type": "Person", "name": "Penjaga"},
                "publisher": {"@type": "Organization", "name": "Maneh"},
                "datePublished": new Date().toISOString()
            };
            
            // Inject test schema
            const script = document.createElement('script');
            script.type = 'application/ld+json';
            script.className = 'seo-jsonld';
            script.textContent = JSON.stringify(testSchema);
            document.head.appendChild(script);
            
            log('✓ Test article schema injected', 'pass');
            
            // Validate
            try {
                const data = JSON.parse(script.textContent);
                if (data['@type'] === 'NewsArticle') {
                    log('✓ Test article schema is valid', 'pass');
                } else {
                    log('✗ Test article schema is invalid', 'fail');
                }
            } catch (e) {
                log(`✗ Test article schema error: ${e.message}`, 'fail');
            }
        }

        function testWebPageSchema() {
            log('Testing WebPage Schema...', 'info');
            
            // Create test web page schema
            const testSchema = {
                "@context": "https://schema.org",
                "@type": "WebPage",
                "mainEntityOfPage": location.origin + location.pathname,
                "name": "Test Page",
                "description": "This is a test page for JSON-LD validation",
                "image": "https://example.com/test.jpg",
                "author": {"@type": "Person", "name": "Penjaga"},
                "publisher": {"@type": "Organization", "name": "Maneh"}
            };
            
            // Inject test schema
            const script = document.createElement('script');
            script.type = 'application/ld+json';
            script.className = 'seo-jsonld';
            script.textContent = JSON.stringify(testSchema);
            document.head.appendChild(script);
            
            log('✓ Test web page schema injected', 'pass');
            
            // Validate
            try {
                const data = JSON.parse(script.textContent);
                if (data['@type'] === 'WebPage') {
                    log('✓ Test web page schema is valid', 'pass');
                } else {
                    log('✗ Test web page schema is invalid', 'fail');
                }
            } catch (e) {
                log(`✗ Test web page schema error: ${e.message}`, 'fail');
            }
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        // Auto-run basic tests on load
        window.addEventListener('load', () => {
            log('JSON-LD Validation Test loaded', 'info');
            log('Click "Test JSON-LD" to start validation', 'info');
        });
    </script>
</body>
</html>
